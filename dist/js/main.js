/*
 neighborhood-map-project 2016-02-23 
*/
function ViewModel(){var a=this;a.map=null,a.apiSuccessful=null,a.currentInfoWindow=null,a.markers=ko.observableArray(),a.query=ko.observable(""),a.results=ko.observableArray(),a.filterLocations=function(){var b=[],c=a.query().toLowerCase();return data.forEach(function(a){a.name.toLowerCase().includes(c)&&b.push(a)}),b},a.updateList=function(b){a.results(a.filterLocations()),a.clearMarkers(),a.updateMarkers(a.filterLocations())},a.clearMarkers=function(){a.markers().forEach(function(a,b){a.setMap(null)}),a.markers.removeAll()},a.updateMarkers=function(b){b.forEach(function(b){b.marker=new google.maps.Marker({map:a.map,position:b.coordinates,animation:null}),b.marker.addListener("click",function(){a.selectedLocation(b)}),a.markers().push(b.marker)})},a.selectedLocation=function(b){a.showPlaceInfo(b),a.map.setCenter(b.marker.getPosition()),a.animate(b.marker)},a.showPlaceInfo=function(b){null!==a.currentInfoWindow&&a.currentInfoWindow.close(),b.infoWindow=new google.maps.InfoWindow({content:a.getHTML(b)}),a.currentInfoWindow=b.infoWindow,a.currentInfoWindow.open(a.map,b.marker)},a.getHTML=function(b){var c="<h1>$name</h1>$wiki",d="$img<p>$wiki</p>",e="";void 0!==b.wiki?(e=d.replace("$wiki","<h5>Wikipedia: </h5>"+b.wiki).replace("$img","Failed to load image"),void 0!==b.img&&(e=d.replace("$wiki","<h5>Wikipedia: </h5>"+b.wiki).replace("$img",b.img))):a.getWikiInfo(b);var f=c.replace("$name",b.name).replace("$wiki",e);return f},a.getWikiInfo=function(b){function c(a){var b="";for(var c in a)if(void 0!==a[c].thumbnail&&void 0!==a[c].thumbnail.source){b=a[c].thumbnail.source;break}return b}var d="http://en.wikipedia.org/w/api.php?action=opensearch&search="+b.name+"&format=json";$.ajax({url:d,dataType:"jsonp",success:function(c){void 0!==c[2][0]&&(b.wiki=c[2][0],b.infoWindow.setContent(a.getHTML(b)))},timeout:1e4,error:function(){a.apiSuccessful!==!1&&(alert("Wikipedia API Failed to load"),a.apiSuccessful=!1)}}),$.getJSON("http://en.wikipedia.org/w/api.php?action=query&format=json&callback=?",{titles:b.name,prop:"pageimages",pithumbsize:150},function(a){var d="",e=c(a.query.pages);""===e?(d="No Image Found",b.img=d):(d="<img class='icon' src=\""+e+'">',b.img=d)})},a.animate=function(a){null!==a.getAnimation()?a.setAnimation(null):a.setAnimation(google.maps.Animation.DROP)},a.initMap=function(){a.map=new google.maps.Map(document.getElementById("map"),{center:{lat:14.602316,lng:120.973803},zoom:12,mapTypeControl:!1})}}function googleError(){alert("Failed to load Google Maps API")}function initialize(){viewModel=new ViewModel,viewModel.initMap(),viewModel.updateList(),ko.applyBindings(viewModel,document.getElementById("list"))}var data=[{name:"University of Santo Tomas",coordinates:{lat:14.608674,lng:120.991006}},{name:"De La Salle University",coordinates:{lat:14.564869,lng:120.993893}},{name:"Ateneo de Manila University",coordinates:{lat:14.639749,lng:121.078216}},{name:"University of the Philippines Diliman",coordinates:{lat:14.660244,lng:121.07022}},{name:"University of the East",coordinates:{lat:14.601791,lng:120.988843}},{name:"Adamson University",coordinates:{lat:14.586954,lng:120.985695}},{name:"Map√∫a Institute of Technology",coordinates:{lat:14.590679,lng:120.978121}},{name:"Technological University of the Philippines",coordinates:{lat:14.587618,lng:120.984714}},{name:"Polytechnic University of The Philippines",coordinates:{lat:14.599329,lng:121.011396}},{name:"Centro Escolar University",coordinates:{lat:14.599329,lng:121.011396}},{name:"University of Asia and the Pacific",coordinates:{lat:14.580406,lng:121.060871}},{name:"Far Eastern University",coordinates:{lat:14.599632,lng:120.991401}}],viewModel;